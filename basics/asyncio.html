<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Integration with Asyncio &mdash; Live Cells Python 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e031e9a9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pitfalls" href="pitfalls.html" />
    <link rel="prev" title="Cell Expressions" href="cell-expressions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Live Cells Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cells.html">Cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell-expressions.html">Cell Expressions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Integration with Asyncio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#asynchronous-cells">Asynchronous Cells</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multiple-arguments">Multiple Arguments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wait-cells">Wait Cells</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reset-option">Reset Option</a></li>
<li class="toctree-l3"><a class="reference internal" href="#queue-option">Queue Option</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Multiple Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preventing-glitches">Preventing Glitches</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pitfalls.html">Pitfalls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">live_cells</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Live Cells Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Integration with Asyncio</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/basics/asyncio.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="integration-with-asyncio">
<h1>Integration with Asyncio<a class="headerlink" href="#integration-with-asyncio" title="Permalink to this heading"></a></h1>
<p>There are a number of tools for integrating cells with asyncio
awaitables and coroutines.</p>
<section id="asynchronous-cells">
<h2>Asynchronous Cells<a class="headerlink" href="#asynchronous-cells" title="Permalink to this heading"></a></h2>
<p>An <em>asynchronous cell</em> is a cell with an <em>awaitable</em> value. To define a
cell that performs a computation on an asynchronously computed value,
define a computed cell with an <code class="docutils literal notranslate"><span class="pre">async</span></code> computation function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">live_cells</span> <span class="k">as</span> <span class="nn">lc</span>

<span class="c1"># Helper for creating awaitables</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">coro1</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">coro1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># An asynchronous computed cell</span>
<span class="nd">@lc</span><span class="o">.</span><span class="n">computed</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">next</span><span class="p">():</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">n</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> is a mutable cell holding an <em>awaitable</em>, in this case
returned by a coroutine function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next</span></code> is a computed cell with a coroutine as its computation
function that <em>awaits</em> the <em>awaitable</em> held in <em>n</em> and adds <code class="docutils literal notranslate"><span class="pre">1</span></code> to
it.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">next</span></code> is an <em>awaitable</em> holding the result returned by
its value computation function.</p></li>
</ul>
<p>To retrieve the result computed by the <code class="docutils literal notranslate"><span class="pre">next</span></code> cell, <code class="docutils literal notranslate"><span class="pre">await</span></code> its
value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="nb">next</span><span class="p">())</span> <span class="c1"># Prints 2</span>
</pre></div>
</div>
<p>When a new <em>awaitable</em> is assigned to <code class="docutils literal notranslate"><span class="pre">n</span></code>, the value of <code class="docutils literal notranslate"><span class="pre">next</span></code> is
recomputed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">coro</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="nb">next</span><span class="p">())</span> <span class="c1"># Prints 6</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The values of asynchronous computed cells, which are <em>awaitables</em>,
are still updated <strong>synchronously</strong> whenever the values of their
arguments change just like any other computed cell. It’s only the
computation functions themselves that are run asynchronously.</p>
</div>
<section id="multiple-arguments">
<h3>Multiple Arguments<a class="headerlink" href="#multiple-arguments" title="Permalink to this heading"></a></h3>
<p>An asynchronous computed cell can reference multiple argument cells,
just like an ordinary computed cell.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">live_cells</span> <span class="k">as</span> <span class="nn">lc</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">delayed</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">delayed</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">delayed</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

<span class="nd">@lc</span><span class="o">.</span><span class="n">computed</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">c</span><span class="p">():</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">a</span><span class="p">()</span> <span class="o">+</span> <span class="k">await</span> <span class="n">b</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="wait-cells">
<h2>Wait Cells<a class="headerlink" href="#wait-cells" title="Permalink to this heading"></a></h2>
<p>A <em>wait cell</em> is a cell that retrieves the result of an <em>awaitable</em>
that is held in another cell. When the <em>awaitable</em> completes with a
value or error, the value of the <em>wait cell</em> is updated to the result
of the <em>awaitable</em>. This allows other cells and watch functions to
retrieve the result of an <em>awaitable</em> without having to use the
<em>await</em> keyword.</p>
<p>Wait cells are created by calling the <a class="reference internal" href="../live_cells.html#live_cells.Cell.waited" title="live_cells.Cell.waited"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">waited</span></code></a> method on an
asynchronous cell, which holds an <em>awaitable</em> value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">live_cells</span> <span class="k">as</span> <span class="nn">lc</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">delayed</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">delayed</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">wait_n</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">waited</span><span class="p">()</span>

<span class="nd">@lc</span><span class="o">.</span><span class="n">computed</span>
<span class="k">def</span> <span class="nf">next</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">wait_n</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">next</span></code> is not an asynchronous computed cell and its
computation function is not a coroutine. Instead, it retrieves the
result of the <em>awaitable</em> held in <code class="docutils literal notranslate"><span class="pre">n</span></code> through a <em>wait cell</em> created
with <code class="docutils literal notranslate"><span class="pre">waited</span></code>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>A <em>wait cell</em> must have at least one observer in order to wait for
<em>asynchronous cells</em>. If the <em>wait cell</em> has no observers, it
neither tracks the completion of the <em>awaitables</em> in the
<em>asynchronous cell</em> nor updates its own value.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">waited</span></code> can be used on any cell that holds an awaitable, regardless
of whether it’s a constant, mutable or computed cell. If the awaitable
completes with an exception, it is raised when accessing the value of
the <em>wait cell</em>. Similarly, exceptions raised by the cell holding the
awaitable itself, are raised when the value of the <em>wait cell</em> is
accessed.</p>
<p>The <a class="reference internal" href="../live_cells.html#live_cells.Cell.wait" title="live_cells.Cell.wait"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">wait</span></code></a> method creates a <em>wait cell</em> and references its value
in one go. This can be used to simplify the definition of <code class="docutils literal notranslate"><span class="pre">next</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@lc</span><span class="o">.</span><span class="n">computed</span>
<span class="k">def</span> <span class="nf">next</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">n.wait()</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">n.waited()()</span></code></p>
</div>
<p>With the default options <code class="docutils literal notranslate"><span class="pre">waited</span></code>/<code class="docutils literal notranslate"><span class="pre">wait</span></code> creates a cell that has
the following behaviour:</p>
<ul class="simple">
<li><p>Accessing the value of the cell before the <em>awaitable</em> has
completed, results in a <a class="reference internal" href="../live_cells.html#live_cells.PendingAsyncValueError" title="live_cells.PendingAsyncValueError"><code class="xref any py py-exc docutils literal notranslate"><span class="pre">PendingAsyncValueError</span></code></a> exception
being raised.</p></li>
<li><p>The value of the cell is updated to the result of the <em>awaitable</em>,
when it completes with a value or an error.</p></li>
<li><p>When the value of the <em>asynchronous cell</em>, which holds the <em>awaitable</em>,
changes, the <em>wait cell</em> is reset, which means:</p>
<ul>
<li><p><a class="reference internal" href="../live_cells.html#live_cells.PendingAsyncValueError" title="live_cells.PendingAsyncValueError"><code class="xref any py py-exc docutils literal notranslate"><span class="pre">PendingAsyncValueError</span></code></a> is raised if its value is accessed
before the new <em>awaitable</em> has completed.</p></li>
<li><p>The previous <em>awaitable</em> is ignored, and no value updates are
emitted for it by the <em>wait cell</em> if it completes after the value
of the <em>asynchronous cell</em> changes.</p></li>
</ul>
</li>
</ul>
<section id="reset-option">
<h3>Reset Option<a class="headerlink" href="#reset-option" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">reset</span></code> argument controls whether the <em>wait cell</em> is reset when
the value of the asynchronous cell changes. By default, <code class="docutils literal notranslate"><span class="pre">reset</span></code> is
<code class="docutils literal notranslate"><span class="pre">True</span></code> if not given, which means the <em>wait cell</em> is reset.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">reset</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> the <em>wait cell</em> is not reset when the value
of the asynchronous cell changes. This means that instead of raising
<a class="reference internal" href="../live_cells.html#live_cells.PendingAsyncValueError" title="live_cells.PendingAsyncValueError"><code class="xref any py py-exc docutils literal notranslate"><span class="pre">PendingAsyncValueError</span></code></a>, the completed value or error of the
previous <em>awaitable</em> is retained until the new <em>awaitable</em> completes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">live_cells</span> <span class="k">as</span> <span class="nn">lc</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="nd">@lc</span><span class="o">.</span><span class="n">watch</span>
<span class="k">def</span> <span class="nf">watch_n</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;N = </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">PendingAsyncValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PendingAsyncValueError&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The watch function defined above, <cite>watch_n</cite>, access the value of the
<em>awaitable</em> held in <code class="docutils literal notranslate"><span class="pre">n</span></code> through a <em>wait cell</em> defined with
<code class="docutils literal notranslate"><span class="pre">reset=True</span></code>, which is the default if no <code class="docutils literal notranslate"><span class="pre">reset</span></code> argument is
given.</p>
<p>When a new <em>awaitable</em> is assigned to <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Give the coroutine a chance to execute</span>
<span class="k">await</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span>

<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>the following is printed to standard output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PendingAsyncValueError</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PendingAsyncValueError</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>If the <em>wait cell</em> is created with <code class="docutils literal notranslate"><span class="pre">reset=False</span></code> instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@lc</span><span class="o">.</span><span class="n">watch</span>
<span class="k">def</span> <span class="nf">watch_n</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;N = </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">PendingAsyncValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PendingAsyncValueError&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>the following is printed to standard output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PendingAsyncValueError</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="queue-option">
<h3>Queue Option<a class="headerlink" href="#queue-option" title="Permalink to this heading"></a></h3>
<p>Even with <code class="docutils literal notranslate"><span class="pre">reset=False</span></code> the <em>wait cell</em> still only waits for the
last <em>awaitable</em> to complete.</p>
<p>When the value of the <em>asynchronous cell</em> changes multiple times
before the <em>awaitables</em> held in the cell have completed, a value
update is only emitted when the last <em>awaitable</em> completes.</p>
<p>The following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>only results in <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">=</span> <span class="pre">5</span></code> being printed to standard output, since the
previous two <em>awaitables</em> did not have a chance to complete.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">queue</span></code> argument controls whether the <em>wait cell</em> waits for
every <em>awaitable</em> to complete or only the last <em>awaitable</em>. By default
<code class="docutils literal notranslate"><span class="pre">queue</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, which means the <em>wait cell</em> only waits for the
last <em>awaitable</em> to complete.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">queue</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> the <em>wait cell</em> waits for all <em>awaitables</em> to
complete.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><code class="docutils literal notranslate"><span class="pre">queue=True</span></code> only has an effect if <code class="docutils literal notranslate"><span class="pre">reset=False</span></code> is also given.</p>
</div>
<p>By creating the <em>wait cell</em> from the previous example with
<code class="docutils literal notranslate"><span class="pre">queue=True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@lc</span><span class="o">.</span><span class="n">watch</span>
<span class="k">def</span> <span class="nf">watch_n</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;N = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">PendingAsyncValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PendingAsyncValueError&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>the following assignments to the cell holding the awaitable <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>result in the following being printed to standard output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>The <em>wait cell</em> waits for the <em>awaitables</em> in the same order as they
are assigned to the asynchronous cell, <code class="docutils literal notranslate"><span class="pre">n</span></code>, which is not necessarily the
same as the order of completion of the <em>awaitables</em>.</p>
<p>For example the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>always results in the following being printed to standard output,
regardless of the actual order of completion of the <em>awaitables</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If an asynchronous cell evaluates to an <em>awaitable</em> that never
completes, all <em>wait cells</em> created with <code class="docutils literal notranslate"><span class="pre">queue=True</span></code> will be
stuck with the completed value of the last <em>awaitable</em>, if
any. Therefore it’s best to only use <code class="docutils literal notranslate"><span class="pre">queue=True</span></code> if you’re
certain that all <em>awaitables</em> will complete.</p>
</div>
</section>
<section id="id1">
<h3>Multiple Arguments<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="../live_cells.html#live_cells.waited" title="live_cells.waited"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.waited</span></code></a> and <a class="reference internal" href="../live_cells.html#live_cells.wait" title="live_cells.wait"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.wait</span></code></a> functions can
be used to create a <em>wait cell</em> that waits for multiple asynchronous
cells simultaneously.</p>
<p><a class="reference internal" href="../live_cells.html#live_cells.waited" title="live_cells.waited"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.waited</span></code></a> takes a variable number of <em>asynchronous
cells</em> as arguments and returns a single <em>wait cell</em> that evaluates to
a list holding the completed values of the <em>awaitables</em> held in the
<em>asynchronous cells</em>. If an <em>asynchronous cell</em> raises an exception,
or an <em>awaitable</em> completes with an error, it is raised by the <em>wait
cell</em>.</p>
<p><a class="reference internal" href="../live_cells.html#live_cells.wait" title="live_cells.wait"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.wait</span></code></a> takes the same arguments as
<a class="reference internal" href="../live_cells.html#live_cells.waited" title="live_cells.waited"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.waited</span></code></a> but creates the <em>wait cell</em> and
references its value in one go much like the <a class="reference internal" href="../live_cells.html#live_cells.Cell.wait" title="live_cells.Cell.wait"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">wait</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">live_cells</span> <span class="k">as</span> <span class="nn">lc</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">delayed</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">delayed</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="n">delayed</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="nd">@lc</span><span class="o">.</span><span class="n">computed</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@lc</span><span class="o">.</span><span class="n">watch</span>
<span class="k">def</span> <span class="nf">watch_sum</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A + B = </span><span class="si">{</span><span class="n">c</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The cell <code class="docutils literal notranslate"><span class="pre">c</span></code> computes the sum of the completed values of the
<em>awaitables</em> held in the <em>asynchronous cells</em> <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>. The
values of the <em>awaitables</em> are accessed through a <em>wait cell</em> that
waits for the both the <em>awaitable</em> held in <code class="docutils literal notranslate"><span class="pre">a</span></code> and the <em>awaitable</em>
held in <code class="docutils literal notranslate"><span class="pre">b</span></code>, simultaneously.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../live_cells.html#live_cells.waited" title="live_cells.waited"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.waited</span></code></a> and <a class="reference internal" href="../live_cells.html#live_cells.wait" title="live_cells.wait"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.wait</span></code></a> accept the same
keyword arguments as <a class="reference internal" href="../live_cells.html#live_cells.Cell.waited" title="live_cells.Cell.waited"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">waited</span></code></a> and <a class="reference internal" href="../live_cells.html#live_cells.Cell.wait" title="live_cells.Cell.wait"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">wait</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="preventing-glitches">
<h4>Preventing Glitches<a class="headerlink" href="#preventing-glitches" title="Permalink to this heading"></a></h4>
<p>This form should be used as opposed to multiple individual <a class="reference internal" href="../live_cells.html#live_cells.Cell.wait" title="live_cells.Cell.wait"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">wait</span></code></a>
calls, since the latter may result in glitches if the <em>asynchronous</em>
cells share a common ancestor or are updated simultaneously in a batch
update. This becomes more apparent if the <code class="docutils literal notranslate"><span class="pre">reset=False</span></code> option is
used.</p>
<p>For example if the computed cell <code class="docutils literal notranslate"><span class="pre">c</span></code> is defined with multiple
individual calls to <a class="reference internal" href="../live_cells.html#live_cells.Cell.wait" title="live_cells.Cell.wait"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">wait</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@lc</span><span class="o">.</span><span class="n">computed</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>and the values of <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are updated simultaneously in a
batch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">lc</span><span class="o">.</span><span class="n">batch</span><span class="p">():</span>
    <span class="n">a</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>the following is printed to standard output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">25</span>
</pre></div>
</div>
<p>If a single call to <a class="reference internal" href="../live_cells.html#live_cells.wait" title="live_cells.wait"><code class="xref any py py-func docutils literal notranslate"><span class="pre">live_cells.wait</span></code></a> is used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@lc</span><span class="o">.</span><span class="n">watch</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>only the following is printed after the batch update:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">25</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cell-expressions.html" class="btn btn-neutral float-left" title="Cell Expressions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pitfalls.html" class="btn btn-neutral float-right" title="Pitfalls" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alexander Gutev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>